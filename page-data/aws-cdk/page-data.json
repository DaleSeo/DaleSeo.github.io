{
    "componentChunkName": "component---src-templates-detail-template-jsx",
    "path": "/aws-cdk/",
    "result": {"pageContext":{"previous":{"fields":{"slug":"/react-search/"},"frontmatter":{"title":"React로 검색 UI 구현하기 (+ Debounce)"}},"node":{"html":"<p>코드로 인프라를 구성하는 Infrastructure as code의 장점이 많이 알려지면서 AWS CDK(Cloud Development Kit)를 도입하는 회사들이 늘어나고 있습니다.\n이번 포스팅에서는 타입스크립트(TypeScript)로 클라우드 인프라를 정의하고 배포할 수 있게 해주는 도구인 AWS CDK에 대해서 알아보겠습니다.</p>\n<h2 id=\"aws-cdk의-등장-배경\" style=\"position:relative;\"><a href=\"#aws-cdk%EC%9D%98-%EB%93%B1%EC%9E%A5-%EB%B0%B0%EA%B2%BD\" aria-label=\"aws cdk의 등장 배경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS CDK의 등장 배경</h2>\n<p>AWS와 같은 클라우드 서비스가 처음에 등장했을 때 많은 사람들은 AWS Management Console과 같은 웹 기반 UI에서 일일이 서버 자원을 프로비전(provision)하고 관리했었습니다.\n하지만 아무래도 사람이 직접 하는 일이다보니 실수할 위험도 높고 여러 서버 리소스를 관리하려면 반복되는 작업이 많아서 큰 회사에서는 적합한 방법이 아니었습니다.</p>\n<p>그래서 AWS CLI나 AWS SDK와 같은 도구를 이용해서 인프라 구성 단계를 스크립트로 작성하여 관리하기 시작합니다.\n이 방법은 인프라가 정상 운영될 때는 효과적이었지만 장애 상황이 발생하면 역시 사람의 개입 필요로 했습니다.</p>\n<p>그러다가 Terraform이나 AWS CloudFormation과 같이 클라우드 인프라를 YAML이나 JSON 파일에 선언적으로 명시하게 됩니다.\n하지만 이 방법은 일반 애플리케이션 개발자들에게 큰 장벽처럼 느껴졌습니다.\n인프라를 선언적으로 명시하는 문법과 API를 별도로 배워야하는 학습 곡선이 컸기 때문입니다.</p>\n<p>그래서 등장하는 것이 범용 프로그래밍 언어로 인프라를 코딩해버리는 AWS CDK와 같은 Infrastructure as code 도구입니다.\nAWS CDK를 통해서 DevOps에게 인프라 설정을 요청하지 않고 개발자 스스로 인프라를 정희하고 배포할 수 있게 됩니다.\n게다가 범용 프로그래밍 언어로 작성이 되어 있기 때문에 인프라의 구성 내용을 테스트까지 할 수 있게 됩니다.</p>\n<h2 id=\"aws-cdk-툴킷-설치\" style=\"position:relative;\"><a href=\"#aws-cdk-%ED%88%B4%ED%82%B7-%EC%84%A4%EC%B9%98\" aria-label=\"aws cdk 툴킷 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS CDK 툴킷 설치</h2>\n<p>AWS CDK 툴킷(toolkit)은 자바스크립트 패키지 매니저를 통해서 터미널에서 쉽게 설치할 수 있습니다.</p>\n<p><a href=\"/?tag=Node.js\">Node.js</a>를 사용하는 프로젝트에서는 터미널에서 <code>npm</code> 명령어를 사용하여 설치합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> i <span class=\"token parameter variable\">-g</span> aws-cdk\n\nadded <span class=\"token number\">2</span> packages <span class=\"token keyword\">in</span> 726ms</code></pre></div>\n<p>차세대 자바스크립트 런타임인 <a href=\"/?tag=Bun\">Bun</a>을 사용하는 프로젝트에서는 <code>bun</code> 명령어로 설치합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ bun i <span class=\"token parameter variable\">-g</span> aws-cdk\nbun <span class=\"token function\">add</span> v1.0.25 <span class=\"token punctuation\">(</span>a8ff7be6<span class=\"token punctuation\">)</span>\n\n installed aws-cdk@2.126.0 with binaries:\n  - cdk\n\n <span class=\"token number\">2</span> packages installed <span class=\"token punctuation\">[</span><span class=\"token number\">612</span>.00ms<span class=\"token punctuation\">]</span></code></pre></div>\n<p>다음과 같이 CDK 버전이 확인되면 설치가 끝난 것입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk <span class=\"token parameter variable\">--version</span>\n<span class=\"token number\">2.126</span>.0 <span class=\"token punctuation\">(</span>build fb74c41<span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"cdk-프로젝트-생성\" style=\"position:relative;\"><a href=\"#cdk-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%83%9D%EC%84%B1\" aria-label=\"cdk 프로젝트 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CDK 프로젝트 생성</h2>\n<p>간단한 실습을 위해서 새로운 디렉토리를 만들고 그 디렉토리로 진입하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">mkdir</span> our-cdk <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> our-cdk</code></pre></div>\n<p><code>cdk init</code> 명령어를 사용하여 <code>app</code> 템플릿으로 실습 프로젝트를 생성합니다.\n사용할 언어는 타입스크립트로 지정해주겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk init app <span class=\"token parameter variable\">--language</span> typescript\nApplying project template app <span class=\"token keyword\">for</span> typescript\n<span class=\"token comment\"># Welcome to your CDK TypeScript project</span>\n\nThis is a blank project <span class=\"token keyword\">for</span> CDK development with TypeScript.\n\nThe <span class=\"token variable\"><span class=\"token variable\">`</span>cdk.json<span class=\"token variable\">`</span></span> <span class=\"token function\">file</span> tells the CDK Toolkit how to execute your app.\n\n<span class=\"token comment\">## Useful commands</span>\n\n* <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">npm</span> run build<span class=\"token variable\">`</span></span>   compile typescript to js\n* <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">npm</span> run <span class=\"token function\">watch</span><span class=\"token variable\">`</span></span>   <span class=\"token function\">watch</span> <span class=\"token keyword\">for</span> changes and compile\n* <span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">npm</span> run <span class=\"token builtin class-name\">test</span><span class=\"token variable\">`</span></span>    perform the jest unit tests\n* <span class=\"token variable\"><span class=\"token variable\">`</span>npx cdk deploy<span class=\"token variable\">`</span></span>  deploy this stack to your default AWS account/region\n* <span class=\"token variable\"><span class=\"token variable\">`</span>npx cdk <span class=\"token function\">diff</span><span class=\"token variable\">`</span></span>    compare deployed stack with current state\n* <span class=\"token variable\"><span class=\"token variable\">`</span>npx cdk synth<span class=\"token variable\">`</span></span>   emits the synthesized CloudFormation template\n\nInitializing a new <span class=\"token function\">git</span> repository<span class=\"token punctuation\">..</span>.\nExecuting <span class=\"token function\">npm</span> install<span class=\"token punctuation\">..</span>.\n✅ All done<span class=\"token operator\">!</span></code></pre></div>\n<p>참고로 <code>-l</code> 또는 <code>--list</code> 옵션과 함께 <code>cdk init</code> 명령어를 사용하면 어떤 템플릿을 사용할 수 있는지 나옵니다.\n<code>lib</code>는 CDK 라이브러릴 개발용 템프릿이고, <code>sample-app</code>은 예제 코드가 함께 들어있는 애플리케이션 템플릿입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk init <span class=\"token parameter variable\">--list</span>\nAvailable templates:\n* app: Template <span class=\"token keyword\">for</span> a CDK Application\n   └─ cdk init app <span class=\"token parameter variable\">--language</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>csharp<span class=\"token operator\">|</span>fsharp<span class=\"token operator\">|</span>go<span class=\"token operator\">|</span><span class=\"token function\">java</span><span class=\"token operator\">|</span>javascript<span class=\"token operator\">|</span>python<span class=\"token operator\">|</span>typescript<span class=\"token punctuation\">]</span>\n* lib: Template <span class=\"token keyword\">for</span> a CDK Construct Library\n   └─ cdk init lib <span class=\"token parameter variable\">--language</span><span class=\"token operator\">=</span>typescript\n* sample-app: Example CDK Application with some constructs\n   └─ cdk init sample-app <span class=\"token parameter variable\">--language</span><span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>csharp<span class=\"token operator\">|</span>fsharp<span class=\"token operator\">|</span>go<span class=\"token operator\">|</span><span class=\"token function\">java</span><span class=\"token operator\">|</span>javascript<span class=\"token operator\">|</span>python<span class=\"token operator\">|</span>typescript<span class=\"token punctuation\">]</span></code></pre></div>\n<h2 id=\"프로젝트-구조\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%A1%B0\" aria-label=\"프로젝트 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로젝트 구조</h2>\n<p>생성된 프로젝트는 대략적인 구조를 파악하면 도움이 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ tree <span class=\"token parameter variable\">-L</span> <span class=\"token number\">1</span>\n<span class=\"token builtin class-name\">.</span>\n├── README.md\n├── bin\n├── cdk.json\n├── jest.config.js\n├── lib\n├── node_modules\n├── package-lock.json\n├── package.json\n├── <span class=\"token builtin class-name\">test</span>\n└── tsconfig.json\n\n<span class=\"token number\">5</span> directories, <span class=\"token number\">6</span> files</code></pre></div>\n<p><code>bin</code> 디렉토리에는 CDK 앱(app)을 정의하는 파일이 들어가고, <code>lib</code> 디렉토리에는 CDK 스택(stack)을 정의하는 파일들이 들어갑니다.\n<code>test</code> 디렉토리에는 CDK 코드에 대한 테스트 코드가 들어갑니다.\n<code>cdj.json</code> 파일은 CDK 설정 파일입니다.</p>\n<p>나머지 파일이나 디렉토리는 전형적인 타입스크립트 프로젝트에서 흔히 볼 수 있는 것들이라 따로 설명은 하지 않겠습니다.</p>\n<h2 id=\"cdk-스택-정의\" style=\"position:relative;\"><a href=\"#cdk-%EC%8A%A4%ED%83%9D-%EC%A0%95%EC%9D%98\" aria-label=\"cdk 스택 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CDK 스택 정의</h2>\n<p>CDK는 컨스트럭트(construct)라는 기본 단위로 구성이 됩니다.\n최상위 단위인 AWS 앱(app)도 Construct, 중간 단위인 AWS 스택(stack)도 Construct, 최하위 단위인 AWS 서비스(service)도 Construct가 됩니다.\n그리고 AWS 입과 AWS 서비스 사이에 AWS 스택(stack)이라는 논리적인 단위를 통해서 하나 이상의 AWS 서비스를 묶어서 AWS 앱에게 제공합니다.</p>\n<p>각 AWS 서비스는 <code>aws-cdk-lib/aws-xxx</code>로 모듈화가 되어있습니다.\n그래서 EC2 서비스가 필요하다면 <code>aws-cdk-lib/aws-ec2</code> 모듈을 불러오면 되고, S3 서비스가 필요하면 <code>aws-cdk-lib/aws-s3</code> 모듈을 불러오면 됩니다.</p>\n<p>실습 프로젝트에서는 정말 단순하게 하나의 SQS 큐(queue)로만 이루어진 스택을 한 번 정의해보겠습니다.</p>\n<div class=\"gatsby-code-title\">lib/our-cdk-stack.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cdk <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> sqs <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib/aws-sqs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OurCdkStack</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">cdk</span><span class=\"token punctuation\">.</span>Stack <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> props<span class=\"token operator\">?</span><span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>StackProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">sqs</span><span class=\"token punctuation\">.</span><span class=\"token function\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OurCdkQueue\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      visibilityTimeout<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>Duration<span class=\"token punctuation\">.</span><span class=\"token function\">seconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>CDK 스택을을 포함한 모든 컨스트런트의 생성자는 항상 동일한 2개의 필수 인자와 1개의 선택 인자를 받도록 약속되어 있습니다.</p>\n<ul>\n<li>scope(필수): 해당 컨스트럭트가 생성되는 상위 범위를 의미하는데, 대부분의 경우 <code>this</code>를 넘긴다고 보시면 됩니다.</li>\n<li>id(필수): 생성된 컨스트럭트를 상위 범위내에서 식별할 수 있는 유일한 ID를 의미합니다.</li>\n<li>props(선택): 컨스트럭트를 생성할 때 설정을 위해 필요한 옵션들을 담는 객체입니다.</li>\n</ul>\n<h2 id=\"cdk-앱-정의\" style=\"position:relative;\"><a href=\"#cdk-%EC%95%B1-%EC%A0%95%EC%9D%98\" aria-label=\"cdk 앱 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CDK 앱 정의</h2>\n<p>위에서 정의한 CDK 스택을 애플리케이션 진입 지점인 CDK 앱에서 불러와서 생성하겠습니다.</p>\n<div class=\"gatsby-code-title\">bin/our-cdk.ts</div>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token hashbang comment\">#!/usr/bin/env node</span>\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"source-map-support/register\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cdk <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> OurCdkStack <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"../lib/our-cdk-stack\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> app <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">cdk</span><span class=\"token punctuation\">.</span><span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">OurCdkStack</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">,</span> <span class=\"token string\">\"OurCdkStack\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"cloudformation-템플릿으로-변환\" style=\"position:relative;\"><a href=\"#cloudformation-%ED%85%9C%ED%94%8C%EB%A6%BF%EC%9C%BC%EB%A1%9C-%EB%B3%80%ED%99%98\" aria-label=\"cloudformation 템플릿으로 변환 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CloudFormation 템플릿으로 변환</h2>\n<p>AWS CDK를 통해 코드로 정의된 인프라를 배포할 때는 내부적으로 AWS CloudFormation이 사용됩니다.\n따라서 AWS CloudFormation에 익숙하시다면 어떻게 변환이될지 확인을 해보는 것이 도움이 될 수 있습니다.</p>\n<p><code>cdk synth</code> 명령어를 사용하여 CDK 코드를 CloudFormation 템플릿으로 변환하여 출력할 수 있습니다.\n여기서 synth는 synthesize의 줄임말인데 한국말로 “합성하다”라는 뜻입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk synth</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">Resources</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">OurCdkQueue33A6ACB9</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SQS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Queue\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">VisibilityTimeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">300</span>\n    <span class=\"token key atrule\">UpdateReplacePolicy</span><span class=\"token punctuation\">:</span> Delete\n    <span class=\"token key atrule\">DeletionPolicy</span><span class=\"token punctuation\">:</span> Delete\n    <span class=\"token key atrule\">Metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">aws:cdk:path</span><span class=\"token punctuation\">:</span> OurCdkStack/OurCdkQueue/Resource\n  <span class=\"token key atrule\">CDKMetadata</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>CDK<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Metadata\n    <span class=\"token key atrule\">Properties</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">Analytics</span><span class=\"token punctuation\">:</span> v2<span class=\"token punctuation\">:</span>deflate64<span class=\"token punctuation\">:</span>H4sIAAAAAAAA/yWMOQ6EMAwA37J9YggF0POCZR+AIDGSgXUETqBA/J2rmtEUk4HJckg/7SbaulFP1MH+C60d1ZUamQX2b8SIqur5keO2GsXHxT618uwokOdDsXcIgySrKcEU13YQIr1EDvRHqF+eQPxK5XMAAAA=\n    <span class=\"token key atrule\">Metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">aws:cdk:path</span><span class=\"token punctuation\">:</span> OurCdkStack/CDKMetadata/Default\n    <span class=\"token key atrule\">Condition</span><span class=\"token punctuation\">:</span> CDKMetadataAvailable\n<span class=\"token key atrule\">Conditions</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">CDKMetadataAvailable</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Fn::Or</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Or</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> af<span class=\"token punctuation\">-</span>south<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>northeast<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>south<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>southeast<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ap<span class=\"token punctuation\">-</span>southeast<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> ca<span class=\"token punctuation\">-</span>central<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> cn<span class=\"token punctuation\">-</span>north<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> cn<span class=\"token punctuation\">-</span>northwest<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Or</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>central<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>north<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>south<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> eu<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">3</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> il<span class=\"token punctuation\">-</span>central<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> me<span class=\"token punctuation\">-</span>central<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> me<span class=\"token punctuation\">-</span>south<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> sa<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Or</span><span class=\"token punctuation\">:</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> us<span class=\"token punctuation\">-</span>east<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> us<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">1</span>\n          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Equals</span><span class=\"token punctuation\">:</span>\n              <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Region\n              <span class=\"token punctuation\">-</span> us<span class=\"token punctuation\">-</span>west<span class=\"token punctuation\">-</span><span class=\"token number\">2</span>\n<span class=\"token key atrule\">Parameters</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">BootstrapVersion</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Type</span><span class=\"token punctuation\">:</span> AWS<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>SSM<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Parameter<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span>Value&lt;String<span class=\"token punctuation\">></span>\n    <span class=\"token key atrule\">Default</span><span class=\"token punctuation\">:</span> /cdk<span class=\"token punctuation\">-</span>bootstrap/hnb659fds/version\n    <span class=\"token key atrule\">Description</span><span class=\"token punctuation\">:</span> Version of the CDK Bootstrap resources in this environment<span class=\"token punctuation\">,</span> automatically retrieved from SSM Parameter Store. <span class=\"token punctuation\">[</span>cdk<span class=\"token punctuation\">:</span>skip<span class=\"token punctuation\">]</span>\n<span class=\"token key atrule\">Rules</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">CheckBootstrapVersion</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">Assertions</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Assert</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">Fn::Not</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Fn::Contains</span><span class=\"token punctuation\">:</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span> <span class=\"token string\">\"1\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"2\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"4\"</span>\n                  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5\"</span>\n                <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">Ref</span><span class=\"token punctuation\">:</span> BootstrapVersion\n        <span class=\"token key atrule\">AssertDescription</span><span class=\"token punctuation\">:</span> CDK bootstrap stack version 6 required. Please run 'cdk bootstrap' with a recent version of the CDK CLI.</code></pre></div>\n<h2 id=\"부트스트랩bootstrap\" style=\"position:relative;\"><a href=\"#%EB%B6%80%ED%8A%B8%EC%8A%A4%ED%8A%B8%EB%9E%A9bootstrap\" aria-label=\"부트스트랩bootstrap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>부트스트랩(bootstrap)</h2>\n<blockquote>\n<p>지금부터 과정은 본인의 AWS 계정과 연동이 필요하기 때문에 CDK 명령어를 실행하는 컴퓨터에 인증 정보가 설정이 되어 있어야 합니다.\n이 부분에 대해서는 <a href=\"/aws-cli-configure/\">별도 포스팅</a>에서 자세히 다루고 있으니 참고 바랍니다.</p>\n</blockquote>\n<p>실습 프로젝트에서는 우리는 한 번도 AWS에 배포를 한 적이 없기 때문에, 우선 부트스트랩(bootstrap)을 거쳐야 하며, 이 과정은 맨 처음에 배포하기 전에 딱 한 번만 필요합니다.</p>\n<p>부트스트랩을 하려면 <code>cdk bootstrap</code> 명령어를 실행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk bootstrap\n ⏳  Bootstrapping environment aws://123456789012/us-east-1<span class=\"token punctuation\">..</span>.\nTrusted accounts <span class=\"token keyword\">for</span> deployment: <span class=\"token punctuation\">(</span>none<span class=\"token punctuation\">)</span>\nTrusted accounts <span class=\"token keyword\">for</span> lookup: <span class=\"token punctuation\">(</span>none<span class=\"token punctuation\">)</span>\nUsing default execution policy of <span class=\"token string\">'arn:aws:iam::aws:policy/AdministratorAccess'</span><span class=\"token builtin class-name\">.</span> Pass <span class=\"token string\">'--cloudformation-execution-policies'</span> to customize.\nCDKToolkit: creating CloudFormation changeset<span class=\"token punctuation\">..</span>.\n ✅  Environment aws://123456789012/us-east-1 bootstrapped.</code></pre></div>\n<h2 id=\"인프라-배포\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%ED%94%84%EB%9D%BC-%EB%B0%B0%ED%8F%AC\" aria-label=\"인프라 배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인프라 배포</h2>\n<p>이제 AWS CDK로 정의한 클라우드 인프라를 AWS 계정에 배포해보겠습니다.\n<code>cdk deploy</code> 명령어를 실행하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk deploy\n\n✨  Synthesis time: <span class=\"token number\">2</span>.85s\n\nOurCdkStack:  start: Building a7df762112a531c48ae8c7f8acde167764f18623e58d461e9232984ddcc5164c:current_account-current_region\nOurCdkStack:  success: Built a7df762112a531c48ae8c7f8acde167764f18623e58d461e9232984ddcc5164c:current_account-current_region\nOurCdkStack:  start: Publishing a7df762112a531c48ae8c7f8acde167764f18623e58d461e9232984ddcc5164c:current_account-current_region\nOurCdkStack:  success: Published a7df762112a531c48ae8c7f8acde167764f18623e58d461e9232984ddcc5164c:current_account-current_region\nOurCdkStack: deploying<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/1<span class=\"token punctuation\">]</span>\nOurCdkStack: creating CloudFormation changeset<span class=\"token punctuation\">..</span>.\n\n ✅  OurCdkStack\n\n✨  Deployment time: <span class=\"token number\">17</span>.24s\n\nStack ARN:\narn:aws:cloudformation:us-east-1:123456789012:stack/OurCdkStack/88fd7dc0-c6f7-11ee-885f-0a75ee166963\n\n✨  Total time: <span class=\"token number\">20</span>.09s</code></pre></div>\n<h2 id=\"생성된-sqs-큐-확인\" style=\"position:relative;\"><a href=\"#%EC%83%9D%EC%84%B1%EB%90%9C-sqs-%ED%81%90-%ED%99%95%EC%9D%B8\" aria-label=\"생성된 sqs 큐 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>생성된 SQS 큐 확인</h2>\n<p>정말로 SQS 큐가 잘 만들어졌는데 AWS CLI를 통해서 확인해볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws sqs list-queues\nQUEUEURLS       https://sqs.us-east-1.amazonaws.com/233081777157/OurCdkStack-OurCdkQueue33A6ACB9-YbvCITYWwPcN</code></pre></div>\n<h2 id=\"cdk-스택-변경\" style=\"position:relative;\"><a href=\"#cdk-%EC%8A%A4%ED%83%9D-%EB%B3%80%EA%B2%BD\" aria-label=\"cdk 스택 변경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CDK 스택 변경</h2>\n<p>이 번에는 우리 실습 스택에 다른 AWS 서비스를 추가해볼까요?\nSQS 큐와 궁합이 딱 맞는 SNS 토픽(topic)를 추가하고, SNS 큐가 SNS 토픽을 구독(subscribe)하도록 설정해주겠습니다.</p>\n<div class=\"gatsby-code-title\">lib/our-cdk-stack.ts</div>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> cdk <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib\"</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> sns <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib/aws-sns\"</span><span class=\"token punctuation\">;</span></span><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> subs <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib/aws-sns-subscriptions\"</span><span class=\"token punctuation\">;</span></span><span class=\"token keyword\">import</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">as</span> sqs <span class=\"token keyword\">from</span> <span class=\"token string\">\"aws-cdk-lib/aws-sqs\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OurCdkStack</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">cdk</span><span class=\"token punctuation\">.</span>Stack <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">constructor</span><span class=\"token punctuation\">(</span>scope<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">,</span> id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> props<span class=\"token operator\">?</span><span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>StackProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">(</span>scope<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> props<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> queue <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">sqs</span><span class=\"token punctuation\">.</span><span class=\"token function\">Queue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OurCdkQueue\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      visibilityTimeout<span class=\"token operator\">:</span> cdk<span class=\"token punctuation\">.</span>Duration<span class=\"token punctuation\">.</span><span class=\"token function\">seconds</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">const</span> topic <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">sns</span><span class=\"token punctuation\">.</span><span class=\"token function\">Topic</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OurCdkTopic\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\n<span class=\"gatsby-highlight-code-line\">    topic<span class=\"token punctuation\">.</span><span class=\"token function\">addSubscription</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">subs</span><span class=\"token punctuation\">.</span><span class=\"token function\">SqsSubscription</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"변경-내역-확인\" style=\"position:relative;\"><a href=\"#%EB%B3%80%EA%B2%BD-%EB%82%B4%EC%97%AD-%ED%99%95%EC%9D%B8\" aria-label=\"변경 내역 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>변경 내역 확인</h2>\n<p><code>cdk diff</code> 명령어를 사용하면 CDK 코드를 배포하기 전에 기존 인프라에서 어떤 부분이 바뀔지를 미리 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk <span class=\"token function\">diff</span>\nStack OurCdkStack\nHold on <span class=\"token keyword\">while</span> we create a read-only change <span class=\"token builtin class-name\">set</span> to get a <span class=\"token function\">diff</span> with accurate replacement information <span class=\"token punctuation\">(</span>use --no-change-set to use a <span class=\"token function\">less</span> accurate but faster template-only <span class=\"token function\">diff</span><span class=\"token punctuation\">)</span>\nIAM Statement Changes\n┌───┬────────────────────┬────────┬─────────────────┬───────────────────────────┬────────────────────────────────────────────────────┐\n│   │ Resource           │ Effect │ Action          │ Principal                 │ Condition                                          │\n├───┼────────────────────┼────────┼─────────────────┼───────────────────────────┼────────────────────────────────────────────────────┤\n│ + │ <span class=\"token variable\">${OurCdkQueue.Arn}</span> │ Allow  │ sqs:SendMessage │ Service:sns.amazonaws.com │ <span class=\"token string\">\"ArnEquals\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>                                     │\n│   │                    │        │                 │                           │   <span class=\"token string\">\"aws:SourceArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"<span class=\"token variable\">${OurCdkTopic}</span>\"</span>                │\n│   │                    │        │                 │                           │ <span class=\"token punctuation\">}</span>                                                  │\n└───┴────────────────────┴────────┴─────────────────┴───────────────────────────┴────────────────────────────────────────────────────┘\n<span class=\"token punctuation\">(</span>NOTE: There may be security-related changes not <span class=\"token keyword\">in</span> this list. See https://github.com/aws/aws-cdk/issues/1299<span class=\"token punctuation\">)</span>\n\nResources\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> AWS::SQS::QueuePolicy OurCdkQueue/Policy OurCdkQueuePolicyAB91D65F\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> AWS::SNS::Subscription OurCdkQueue/OurCdkStackOurCdkTopic26BAF067 OurCdkQueueOurCdkStackOurCdkTopic26BAF067EC71333E\n<span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> AWS::SNS::Topic OurCdkTopic OurCdkTopic03E28823\n\n\n✨  Number of stacks with differences: <span class=\"token number\">1</span></code></pre></div>\n<p>IAM 설정 항목이 하나 추가되고, 리소스가 세개가 추가가 될 거라고 합니다.\nCDK 코드에서 제가 직접 IAM 설정은 해준 적이 없지만, SNS 토픽이 SQS 큐로 메세지를 보매려면 권한이 필요하기 때문에 자동으로 추가된 것을 볼 수 있습니다.</p>\n<p>이 작업을 AWS Management Console이나 AWS CLI를 통해서 설정했더라면, 시행착오를 겪어 가면서 제가 일일이 IAM 설정까지 해줘어야 했을 것입니다.\nAWS CDK를 사용하니 이런 부분이 자동으로 해결이 되서 너무 편리합니다.</p>\n<h2 id=\"인프라-재배포\" style=\"position:relative;\"><a href=\"#%EC%9D%B8%ED%94%84%EB%9D%BC-%EC%9E%AC%EB%B0%B0%ED%8F%AC\" aria-label=\"인프라 재배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>인프라 재배포</h2>\n<p>CDK로 변경한 인프라를 AWS에 다시 배포해보겠습니다.</p>\n<p>역시 <code>cdk deploy</code> 명령어를 사용하는데, 처음에 배포했을 때와 달리 이번에는 보안 관련 변경 사항이 있다고 정말로 진행할지 한 번 더 물어보는 것을 볼 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ cdk deploy\n\n✨  Synthesis time: <span class=\"token number\">2</span>.04s\n\nOurCdkStack:  start: Building 9a0994ee54ae5ef2f1263ccfe62bfa16065a331a9370fae4e639556b4eca47e1:current_account-current_region\nOurCdkStack:  success: Built 9a0994ee54ae5ef2f1263ccfe62bfa16065a331a9370fae4e639556b4eca47e1:current_account-current_region\nOurCdkStack:  start: Publishing 9a0994ee54ae5ef2f1263ccfe62bfa16065a331a9370fae4e639556b4eca47e1:current_account-current_region\nOurCdkStack:  success: Published 9a0994ee54ae5ef2f1263ccfe62bfa16065a331a9370fae4e639556b4eca47e1:current_account-current_region\nThis deployment will <span class=\"token function\">make</span> potentially sensitive changes according to your current security approval level <span class=\"token punctuation\">(</span>--require-approval broadening<span class=\"token punctuation\">)</span>.\nPlease confirm you intend to <span class=\"token function\">make</span> the following modifications:\n\nIAM Statement Changes\n┌───┬────────────────────┬────────┬─────────────────┬───────────────────────────┬────────────────────────────────────────────────────┐\n│   │ Resource           │ Effect │ Action          │ Principal                 │ Condition                                          │\n├───┼────────────────────┼────────┼─────────────────┼───────────────────────────┼────────────────────────────────────────────────────┤\n│ + │ <span class=\"token variable\">${OurCdkQueue.Arn}</span> │ Allow  │ sqs:SendMessage │ Service:sns.amazonaws.com │ <span class=\"token string\">\"ArnEquals\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">{</span>                                     │\n│   │                    │        │                 │                           │   <span class=\"token string\">\"aws:SourceArn\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"<span class=\"token variable\">${OurCdkTopic}</span>\"</span>                │\n│   │                    │        │                 │                           │ <span class=\"token punctuation\">}</span>                                                  │\n└───┴────────────────────┴────────┴─────────────────┴───────────────────────────┴────────────────────────────────────────────────────┘\n<span class=\"token punctuation\">(</span>NOTE: There may be security-related changes not <span class=\"token keyword\">in</span> this list. See https://github.com/aws/aws-cdk/issues/1299<span class=\"token punctuation\">)</span>\n\nDo you wish to deploy these changes <span class=\"token punctuation\">(</span>y/n<span class=\"token punctuation\">)</span>?</code></pre></div>\n<p>터미널에서 <code>y</code>를 입력하면 AWS로 변경된 인프라가 배포되기 시작합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Do you wish to deploy these changes <span class=\"token punctuation\">(</span>y/n<span class=\"token punctuation\">)</span>? y\nOurCdkStack: deploying<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>/1<span class=\"token punctuation\">]</span>\nOurCdkStack: creating CloudFormation changeset<span class=\"token punctuation\">..</span>.\n\n ✅  OurCdkStack\n\n✨  Deployment time: <span class=\"token number\">17</span>.65s\n\nStack ARN:\narn:aws:cloudformation:us-east-1:233081777157:stack/OurCdkStack/88fd7dc0-c6f7-11ee-885f-0a75ee166963\n\n✨  Total time: <span class=\"token number\">19</span>.69s</code></pre></div>\n<h2 id=\"생성된-sns-토픽-확인\" style=\"position:relative;\"><a href=\"#%EC%83%9D%EC%84%B1%EB%90%9C-sns-%ED%86%A0%ED%94%BD-%ED%99%95%EC%9D%B8\" aria-label=\"생성된 sns 토픽 확인 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>생성된 SNS 토픽 확인</h2>\n<p>역시 AWS CLI를 통해 SNS 토픽이 잘 생성된 것을 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ aws sns list-topics\nTOPICS  arn:aws:sns:us-east-1:233081777157:OurCdkStack-OurCdkTopic03E28823-5uGPC8UQQaWT</code></pre></div>\n<h2 id=\"마치면서\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B4%EC%84%9C\" aria-label=\"마치면서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치면서</h2>\n<p>이상으로 AWS CDK를 통해서 타입스크립트로 클라우드 인프라를 정의하고 배포하는 방법에 대해서 실습해보았습니다.</p>\n<p>AWS를 사용 경험이 없으시다면 본 포스팅을 따라오기가 어려우셨을 것 같습니다.\n느끼셨겠지만 AWS CDK를 제대로 활용하려면 AWS 서비스에 대한 전반적인 지식이 어느 정도는 있어야 합니다.</p>\n<p>후속 포스팅에서는 CDK 코드를 테스트하는 방법에 대해서 알아보도록 하겠습니다.</p>","timeToRead":12,"fields":{"slug":"/aws-cdk/","tags":["AWS","CDK","JavaScript","TypeScript","SQS","SNS"]},"frontmatter":{"title":"타입스크립트로 AWS CDK 시작하기","date":"Feb 7, 2024"}},"next":{"fields":{"slug":"/woowahan-typescript-with-react/"},"frontmatter":{"title":"도서 리뷰: 우아한 타입스크립트 with 리액트"}}}},
    "staticQueryHashes": ["2168229929","2362167539","3056348342"]}