{
    "componentChunkName": "component---src-templates-detail-template-jsx",
    "path": "/rust-arc/",
    "result": {"pageContext":{"previous":{"fields":{"slug":"/ngrok/"},"frontmatter":{"title":"ngrok으로 로컬 서버를 인터넷에 공개하기"}},"node":{"html":"<p>Rust의 소유권 시스템은 메모리 안전성을 보장해주지만, 여러 스레드에서 같은 데이터를 공유하려고 하면 컴파일러가 허용하지 않습니다.\n“한 번에 하나의 소유자만 존재할 수 있다”는 규칙 때문입니다.\n소유권을 이동하면 다른 스레드에서 사용할 수 없고, 참조를 전달하려고 하면 라이프타임 문제로 컴파일 오류가 발생합니다.</p>\n<p>실제로는 여러 스레드가 같은 설정 값을 읽거나, 공유 데이터를 참조해야 하는 상황이 많습니다.\n예를 들어 웹 서버에서 모든 워커 스레드가 동일한 설정 파일을 읽어야 하거나, 여러 스레드가 같은 캐시 데이터를 조회해야 할 수 있습니다.\n하지만 소유권 규칙 때문에 이런 패턴을 구현하기가 쉽지 않습니다.</p>\n<p>Arc(Atomic Reference Counting)는 이 문제를 해결하는 스마트 포인터입니다.\n여러 소유자가 같은 데이터를 안전하게 공유할 수 있도록 해줍니다.\n이 글에서는 Arc가 무엇이고, 어떻게 사용하는지, 그리고 실전에서 어떻게 활용하는지 살펴보겠습니다.\n소유권과 빌림의 기본 개념은 <a href=\"/rust-ownership/\">소유권과 빌림</a> 글에서 다루고 있으니 참고하시기 바랍니다.</p>\n<h2 id=\"arc가-필요한-이유\" style=\"position:relative;\"><a href=\"#arc%EA%B0%80-%ED%95%84%EC%9A%94%ED%95%9C-%EC%9D%B4%EC%9C%A0\" aria-label=\"arc가 필요한 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arc가 필요한 이유</h2>\n<p>멀티스레드 프로그래밍을 하다 보면 자연스럽게 여러 스레드가 같은 데이터를 읽어야 하는 상황이 발생합니다.\n하지만 Rust의 소유권 시스템은 이를 간단하게 허용하지 않습니다.\n스레드는 각자 독립적인 스택을 가지고 있고, 스레드의 수명을 컴파일 시점에 정확히 알 수 없기 때문에 일반적인 참조를 스레드로 전달할 수 없습니다.</p>\n<p>다음 코드를 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"합계: {}\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">::</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">i32</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 코드는 컴파일되지 않습니다.\n컴파일러는 “closure may outlive the current function”이라는 오류를 발생시킵니다.\n스레드가 메인 스레드보다 오래 살 수 있기 때문에, <code>data</code>가 drop된 후에도 스레드가 이를 참조할 가능성이 있습니다.\nRust는 이런 댕글링 참조를 컴파일 시점에 방지합니다.</p>\n<p><code>move</code> 키워드를 사용해서 소유권을 스레드로 이동할 수도 있지만, 그러면 메인 스레드나 다른 스레드에서는 <code>data</code>를 사용할 수 없습니다.\n소유권은 오직 하나의 소유자만 가질 수 있기 때문입니다.\n여러 스레드가 동시에 같은 데이터를 읽어야 하는 상황에서는 이 방법도 적합하지 않습니다.\n이것이 바로 Arc가 필요한 이유입니다.</p>\n<h2 id=\"rc와-arc의-차이점\" style=\"position:relative;\"><a href=\"#rc%EC%99%80-arc%EC%9D%98-%EC%B0%A8%EC%9D%B4%EC%A0%90\" aria-label=\"rc와 arc의 차이점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rc와 Arc의 차이점</h2>\n<p>Arc를 이해하려면 먼저 <a href=\"/rust-rc/\">Rc(Reference Counted)</a>를 알아야 합니다.\nRc는 단일 스레드 환경에서 여러 소유자가 같은 데이터를 공유할 수 있게 해주는 스마트 포인터입니다.\nRc는 참조 카운트를 내부적으로 관리하면서, 데이터를 가리키는 참조가 몇 개인지 추적합니다.\n마지막 참조가 drop될 때 비로소 데이터가 메모리에서 해제됩니다.</p>\n<p>하지만 Rc는 스레드 안전하지 않습니다.\n참조 카운트를 일반 정수로 관리하기 때문에, 여러 스레드에서 동시에 카운트를 증가시키거나 감소시키면 데이터 경쟁이 발생할 수 있습니다.\n실제로 Rc를 스레드 간에 공유하려고 하면 컴파일 오류가 발생합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>rc<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Rc</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> data_clone <span class=\"token operator\">=</span> <span class=\"token class-name\">Rc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{:?}\"</span><span class=\"token punctuation\">,</span> data_clone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>컴파일러는 ”<code>Rc&#x3C;Vec&#x3C;i32>></code> cannot be sent between threads safely”라는 오류를 발생시킵니다.\nRc는 <code>Send</code> 트레이트를 구현하지 않기 때문에 스레드 경계를 넘을 수 없습니다.</p>\n<p>Arc는 이 문제를 해결합니다.\nArc는 Atomic Reference Counted의 약자로, 원자적(atomic) 연산을 사용하여 참조 카운트를 관리합니다.\n원자적 연산은 CPU 레벨에서 여러 스레드가 동시에 접근해도 안전하도록 보장됩니다.\n따라서 Arc는 스레드 간에 안전하게 공유될 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Arc</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> data_clone <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{:?}\"</span><span class=\"token punctuation\">,</span> data_clone<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span><span class=\"token number\">1</span>, <span class=\"token number\">2</span>, <span class=\"token number\">3</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Rc를 Arc로 바꾸기만 하면 코드가 정상적으로 컴파일되고 실행됩니다.\n원자적 연산은 일반 정수 연산보다 약간 느리지만, 그 대가로 스레드 안전성을 얻을 수 있습니다.\n단일 스레드 환경에서는 <a href=\"/rust-rc/\">Rc</a>를, 멀티 스레드 환경에서는 Arc를 사용하면 됩니다.</p>\n<h2 id=\"arc-기본-사용법\" style=\"position:relative;\"><a href=\"#arc-%EA%B8%B0%EB%B3%B8-%EC%82%AC%EC%9A%A9%EB%B2%95\" aria-label=\"arc 기본 사용법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arc 기본 사용법</h2>\n<p>Arc는 <code>Arc::new()</code>로 생성합니다.\nArc로 감싼 값은 힙 메모리에 저장되고, Arc는 그 값에 대한 포인터와 참조 카운트를 관리합니다.\nArc를 복제하면 데이터 자체가 복사되는 것이 아니라, 같은 힙 메모리를 가리키는 새로운 Arc가 만들어지고 참조 카운트가 증가합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Arc</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> message <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">::</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"안녕하세요\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"참조 카운트: {}\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">strong_count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> message2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">let</span> message3 <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"참조 카운트: {}\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">strong_count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"메시지: {}\"</span><span class=\"token punctuation\">,</span> message2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"참조 카운트: {}\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">strong_count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">참조 카운트: <span class=\"token number\">1</span>\n참조 카운트: <span class=\"token number\">3</span>\n메시지: 안녕하세요\n참조 카운트: <span class=\"token number\">1</span></code></pre></div>\n<p>처음 <code>message</code>를 생성했을 때 참조 카운트는 1입니다.\n내부 스코프에서 <code>message2</code>와 <code>message3</code>를 복제하면 참조 카운트가 3으로 증가합니다.\n세 개의 Arc가 모두 같은 <code>String</code> 데이터를 가리키고 있습니다.\n내부 스코프를 벗어나면 <code>message2</code>와 <code>message3</code>가 drop되면서 참조 카운트가 다시 1로 감소합니다.</p>\n<p><code>Arc::clone(&#x26;arc)</code>는 <code>arc.clone()</code>과 동일합니다.\n다만 <code>Arc::clone()</code>을 명시적으로 사용하면 이것이 깊은 복사가 아니라 참조 카운트만 증가시키는 저렴한 연산임을 코드를 읽는 사람에게 명확히 알릴 수 있습니다.</p>\n<p>마지막 Arc가 스코프를 벗어나면 참조 카운트가 0이 되고, 그때 비로소 힙 메모리가 자동으로 해제됩니다.\n개발자가 직접 메모리를 관리할 필요가 없습니다.</p>\n<h2 id=\"스레드-간-arc-공유하기\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%EB%A0%88%EB%93%9C-%EA%B0%84-arc-%EA%B3%B5%EC%9C%A0%ED%95%98%EA%B8%B0\" aria-label=\"스레드 간 arc 공유하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스레드 간 Arc 공유하기</h2>\n<p>Arc의 진가는 멀티스레드 환경에서 발휘됩니다.\n여러 스레드가 같은 데이터를 읽어야 할 때, 각 스레드에 Arc의 복제본을 전달하면 됩니다.\n메인 스레드에서 Arc를 복제한 후, 각 복제본을 <code>move</code> 클로저로 스레드에 이동시키는 패턴을 사용합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Arc</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> numbers <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span> <span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8</span><span class=\"token punctuation\">,</span> <span class=\"token number\">9</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> handles <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span><span class=\"token number\">3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> numbers_clone <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>numbers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> sum<span class=\"token punctuation\">:</span> <span class=\"token keyword\">i32</span> <span class=\"token operator\">=</span> numbers_clone<span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"스레드 {}: 합계 = {}\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">,</span> sum<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        handles<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">for</span> handle <span class=\"token keyword\">in</span> handles <span class=\"token punctuation\">{</span>\n        handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"메인: 참조 카운트 = {}\"</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">strong_count</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>numbers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">스레드 <span class=\"token number\">0</span>: 합계 <span class=\"token operator\">=</span> <span class=\"token number\">55</span>\n스레드 <span class=\"token number\">1</span>: 합계 <span class=\"token operator\">=</span> <span class=\"token number\">55</span>\n스레드 <span class=\"token number\">2</span>: 합계 <span class=\"token operator\">=</span> <span class=\"token number\">55</span>\n메인: 참조 카운트 <span class=\"token operator\">=</span> <span class=\"token number\">1</span></code></pre></div>\n<p>세 개의 스레드가 동시에 같은 벡터 데이터에 접근하여 합계를 계산합니다.\n각 스레드는 <code>numbers</code>의 Arc 복제본을 소유하고 있으므로, 스레드가 실행되는 동안 데이터가 유효함이 보장됩니다.\n모든 스레드가 작업을 마치고 <code>join()</code>으로 종료를 기다린 후에는, 메인 스레드의 <code>numbers</code>만 남아 있어 참조 카운트가 1이 됩니다.</p>\n<p>이 패턴은 매우 안전합니다.\nRust의 타입 시스템이 컴파일 시점에 데이터 경쟁을 방지해주기 때문에, 런타임에 예상치 못한 버그가 발생할 가능성이 거의 없습니다.\n스레드 수가 많아지더라도 같은 패턴을 사용하면 됩니다.</p>\n<h2 id=\"arc와-mutex를-함께-사용하기\" style=\"position:relative;\"><a href=\"#arc%EC%99%80-mutex%EB%A5%BC-%ED%95%A8%EA%BB%98-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"arc와 mutex를 함께 사용하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arc와 Mutex를 함께 사용하기</h2>\n<p>Arc 단독으로는 불변 참조만 제공합니다.\n여러 스레드에서 데이터를 읽는 것은 가능하지만, 수정하는 것은 불가능합니다.\nArc가 제공하는 것은 공유 소유권이지 내부 가변성이 아니기 때문입니다.\n여러 스레드에서 데이터를 수정하려면 Mutex(상호 배제)를 함께 사용해야 합니다.</p>\n<p><code>Arc&#x3C;Mutex&#x3C;T>></code> 패턴은 Rust에서 공유 가변 상태를 관리하는 표준적인 방법입니다.\nArc는 여러 스레드 간에 Mutex를 공유하고, Mutex는 한 번에 하나의 스레드만 데이터에 접근할 수 있도록 보장합니다.\n<code>lock()</code> 메서드를 호출하면 <code>MutexGuard</code>가 반환되는데, 이를 통해 내부 데이터에 가변 접근할 수 있습니다.\n<code>MutexGuard</code>는 스코프를 벗어날 때 자동으로 락을 해제하므로, 락을 해제하는 것을 잊어버릴 걱정이 없습니다.</p>\n<p>간단한 카운터 예제를 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span><span class=\"token class-name\">Arc</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> counter <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> handles <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span><span class=\"token number\">10</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> counter_clone <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>counter<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> num <span class=\"token operator\">=</span> counter_clone<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token operator\">*</span>num <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        handles<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">for</span> handle <span class=\"token keyword\">in</span> handles <span class=\"token punctuation\">{</span>\n        handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"최종 카운트: {}\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>counter<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">최종 카운트: <span class=\"token number\">10</span></code></pre></div>\n<p>열 개의 스레드가 각각 카운터를 1씩 증가시킵니다.\n<code>lock()</code>을 호출하면 다른 스레드가 락을 해제할 때까지 대기하고, 락을 획득한 후에 값을 수정합니다.\n<code>MutexGuard</code>가 스코프를 벗어나면 자동으로 락이 해제되어 다른 스레드가 접근할 수 있게 됩니다.\n최종 결과는 정확히 10이 됩니다.</p>\n<p>조금 더 실용적인 예제로 작업 큐를 만들어보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span><span class=\"token class-name\">Arc</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>collections<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">VecDeque</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> queue <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">VecDeque</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> handles <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span><span class=\"token number\">3</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> queue_clone <span class=\"token operator\">=</span> <span class=\"token class-name\">Arc</span><span class=\"token punctuation\">::</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>queue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> q <span class=\"token operator\">=</span> queue_clone<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            q<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span><span class=\"token macro property\">format!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"작업-{}\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"추가됨: 작업-{}\"</span><span class=\"token punctuation\">,</span> i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        handles<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">for</span> handle <span class=\"token keyword\">in</span> handles <span class=\"token punctuation\">{</span>\n        handle<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">let</span> q <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"큐 내용: {:?}\"</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">*</span>q<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">추가됨: 작업-0\n추가됨: 작업-1\n추가됨: 작업-2\n큐 내용: <span class=\"token punctuation\">[</span><span class=\"token string\">\"작업-0\"</span>, <span class=\"token string\">\"작업-1\"</span>, <span class=\"token string\">\"작업-2\"</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>여러 스레드가 동시에 작업을 큐에 추가합니다.\nMutex 덕분에 각 스레드는 순차적으로 큐에 접근하여 데이터 경쟁 없이 안전하게 작업을 추가할 수 있습니다.\n실제 프로그램에서는 이 패턴을 확장하여 생산자-소비자 패턴을 구현할 수 있습니다.</p>\n<p>주의할 점은 락을 너무 오래 잡고 있으면 다른 스레드가 대기하게 되어 성능이 저하될 수 있다는 것입니다.\n또한 여러 Mutex를 잘못된 순서로 획득하면 데드락이 발생할 수 있으니 주의해야 합니다.</p>\n<h2 id=\"arc의-성능-특성\" style=\"position:relative;\"><a href=\"#arc%EC%9D%98-%EC%84%B1%EB%8A%A5-%ED%8A%B9%EC%84%B1\" aria-label=\"arc의 성능 특성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Arc의 성능 특성</h2>\n<p>Arc는 편리하지만 공짜가 아닙니다.\n원자적 연산은 일반 정수 연산보다 느립니다.\nCPU가 여러 코어 간에 메모리 상태를 동기화해야 하기 때문입니다.\n따라서 Rc보다 약간 느리지만, 그 대가로 스레드 안전성을 얻을 수 있습니다.</p>\n<p>Arc를 복제하는 것은 큰 데이터를 복사하는 것보다 훨씬 저렴합니다.\n참조 카운트만 원자적으로 증가시키면 되기 때문입니다.\n하지만 완전히 공짜는 아닙니다.\n복제할 때마다 원자적 증가 연산이 발생하고, drop될 때마다 원자적 감소 연산이 발생합니다.\n또한 Arc 자체가 참조 카운트를 저장하는 메모리 오버헤드를 가지고 있습니다.</p>\n<p>Arc를 사용하지 말아야 할 때도 있습니다.\n단일 스레드 환경에서는 <a href=\"/rust-rc/\">Rc</a>를 사용하는 것이 더 효율적입니다.\n소유권을 완전히 이전할 수 있다면 채널(channel)을 사용하는 것이 더 나을 수 있습니다.\n채널은 메시지 패싱 방식으로 스레드 간 통신을 할 수 있게 해주는데, 공유 상태보다 더 안전하고 명확한 경우가 많습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>sync<span class=\"token punctuation\">::</span></span>mpsc<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> <span class=\"token punctuation\">(</span>tx<span class=\"token punctuation\">,</span> rx<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token namespace\">mpsc<span class=\"token punctuation\">::</span></span><span class=\"token function\">channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> <span class=\"token macro property\">vec!</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n        tx<span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">let</span> received <span class=\"token operator\">=</span> rx<span class=\"token punctuation\">.</span><span class=\"token function\">recv</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"받은 데이터: {:?}\"</span><span class=\"token punctuation\">,</span> received<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-code-title\">결과</div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">받은 데이터: <span class=\"token punctuation\">[</span><span class=\"token number\">1</span>, <span class=\"token number\">2</span>, <span class=\"token number\">3</span>, <span class=\"token number\">4</span>, <span class=\"token number\">5</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>채널을 사용하면 소유권이 스레드 간에 이동하므로, 여러 스레드가 동시에 같은 데이터를 읽을 필요가 없는 경우에는 이 방식이 더 적합합니다.\nArc는 여러 스레드가 동시에 같은 데이터를 읽어야 할 때 사용하세요.</p>\n<p>성능이 정말 중요한 상황이라면 벤치마크를 통해 측정하는 것이 좋습니다.\n대부분의 경우 Arc의 오버헤드는 무시할 만한 수준이지만, 극단적으로 성능이 중요한 코드에서는 다른 대안을 고려해볼 필요가 있습니다.</p>\n<h2 id=\"마치며\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EC%B9%98%EB%A9%B0\" aria-label=\"마치며 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마치며</h2>\n<p>Arc는 원자적 참조 카운팅을 통해 여러 스레드 간 안전한 데이터 공유를 가능하게 해주는 스마트 포인터입니다.\nArc 단독으로는 불변 데이터를 여러 스레드에서 읽을 때 사용하고, Arc와 Mutex를 함께 사용하면 가변 데이터를 여러 스레드에서 공유하고 수정할 수 있습니다.</p>\n<p>작은 성능 비용이 있지만, 그 대가로 컴파일 타임에 안전성을 보장받고 편리하게 멀티스레드 프로그래밍을 할 수 있습니다.\nRust의 타입 시스템 덕분에 데이터 경쟁이나 댕글링 포인터 같은 버그를 컴파일 시점에 방지할 수 있습니다.\n이것이 Rust가 안전한 동시성을 제공한다고 말하는 이유입니다.</p>\n<p>Arc의 개념이 처음에는 복잡해 보일 수 있지만, 몇 번 사용해보면 Rust에서 멀티스레드 프로그래밍을 할 때 없어서는 안 될 도구라는 것을 알게 될 것입니다.\n소유권 시스템과 함께 사용하면 안전하고 효율적인 동시성 코드를 작성할 수 있습니다.</p>\n<p>소유권과 빌림의 기본 개념은 <a href=\"/rust-ownership/\">소유권과 빌림</a> 글을 참고하시기 바랍니다.\n다음 단계로는 채널을 이용한 메시지 패싱이나 async/await를 사용한 비동기 프로그래밍 등 다른 동시성 패턴도 학습해보시기를 권장합니다.</p>","timeToRead":8,"fields":{"slug":"/rust-arc/","tags":["Rust","Arc"]},"frontmatter":{"title":"Rust 기초: Arc로 스레드 간 데이터 공유하기","date":"Dec 8, 2025"}},"next":{"fields":{"slug":"/rust-rc/"},"frontmatter":{"title":"Rust 기초: Rc로 단일 스레드에서 데이터 공유하기"}}}},
    "staticQueryHashes": ["2168229929","2362167539","3056348342"]}